<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åŠ å¯†è´§å¸æ”¯ä»˜</title>
  <!-- å¼•å…¥QRCode.jsåº“ -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      line-height: 1.6;
      margin: 0;
      padding: 0;
      background-color: #f7f9fc;
    }
    
    .payment-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }
    
    .payment-card {
      max-width: 450px;
      width: 100%;
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      padding: 30px;
      text-align: center;
    }
    
    .logo {
      margin-bottom: 20px;
    }
    
    .logo img {
      width: 60px;
      height: 60px;
    }
    
    .order-number {
      font-size: 14px;
      margin-bottom: 15px;
      color: #333;
    }
    
    .payment-network {
      font-size: 14px;
      margin-bottom: 15px;
      color: #555;
    }
    
    .warning-message {
      margin-bottom: 20px;
    }
    
    .error {
      color: #ff4d4f;
      font-size: 14px;
      margin-bottom: 5px;
    }
    
    .copy-tip {
      color: #666;
      font-size: 14px;
    }
    
    .payment-amount {
      margin: 25px 0;
      cursor: pointer;
      display: inline-block;
      padding: 5px 15px;
      border-radius: 4px;
      transition: background-color 0.2s;
    }
    
    .payment-amount:hover {
      background-color: #f5f7fa;
    }
    
    .amount {
      font-size: 32px;
      font-weight: bold;
      margin-right: 10px;
    }
    
    .currency {
      font-size: 18px;
      color: #666;
    }
    
    .wallet-address {
      font-family: monospace;
      background-color: #f5f7fa;
      padding: 10px;
      border-radius: 6px;
      font-size: 14px;
      word-break: break-all;
      margin-bottom: 25px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .wallet-address:hover {
      background-color: #e9ecef;
    }
    
    .qr-code {
      margin: 20px auto;
      width: 200px;
      height: 200px;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }
    
    .qr-code img {
      max-width: 100%;
      max-height: 100%;
    }
    
    .loading-qr {
      color: #999;
      font-size: 14px;
    }
    
    .expired-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 8px;
      z-index: 2;
    }
    
    .expired-message {
      color: white;
      text-align: center;
    }
    
    .expired-message p {
      font-size: 16px;
      margin-bottom: 15px;
    }
    
    .refresh-btn {
      background-color: #1890ff;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.2s;
    }
    
    .refresh-btn:hover {
      background-color: #40a9ff;
    }
    
    .countdown {
      margin-top: 20px;
    }
    
    .validity-notice {
      color: #666;
      font-size: 14px;
      margin-bottom: 10px;
    }
    
    .timer {
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    .time {
      background-color: #333;
      color: white;
      font-size: 22px;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 4px;
      margin: 0 2px;
    }
    
    .label {
      margin: 0 5px;
      color: #666;
      font-size: 14px;
    }
    
    .toast {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 10px 20px;
      border-radius: 4px;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .toast.show {
      opacity: 1;
    }
    
    .tether-logo {
      fill: #53ae94;
    }
    
    .tether-logo-text {
      fill: #fff;
    }

    .payment-memo {
      margin-top: 15px;
      padding: 15px;
      background-color: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #1890ff;
    }

    .memo-title {
      font-weight: bold;
      margin-bottom: 8px;
      color: #333;
    }

    .memo-text {
      color: #666;
      font-size: 14px;
      line-height: 1.5;
    }

    .important {
      color: #ff4d4f;
      font-weight: 500;
    }

    .network-info {
      margin-top: 20px;
      border-top: 1px dashed #ddd;
      padding-top: 15px;
      font-size: 13px;
      color: #888;
    }

    .active-network {
      background-color: #1890ff !important;
      color: white !important;
      border-color: #1890ff !important;
    }
  </style>
</head>
<body>
  <div class="payment-container">
    <div class="payment-card">
      <div class="logo">
        <svg viewBox="0 0 2000 2000" width="60" height="60" xmlns="http://www.w3.org/2000/svg">
          <path class="tether-logo" d="M1000,0c552.26,0,1000,447.74,1000,1000S1552.24,2000,1000,2000,0,1552.38,0,1000,447.68,0,1000,0"></path>
          <path class="tether-logo-text" d="M1123.42,866.76V718H1463.6V491.34H537.28V718H877.5V866.64C601,879.34,393.1,934.1,393.1,999.7s208,120.36,484.4,133.14v476.5h246V1132.8c276-12.74,483.48-67.46,483.48-133s-207.48-120.26-483.48-133m0,227.24v-0.12c-6.94.44-42.6,2.58-122,2.58-63.48,0-108.14-1.8-123.88-2.62v0.2c-246.4-11.2-410.1-43.92-410.1-83.66s163.7-72.46,410.1-83.66v0.2c15.86-.82,61.2-2.62,124.4-2.62,77.74,0,114.1,2.14,121.48,2.58v-0.12c245.6,11.2,409.22,43.92,409.22,83.62s-163.62,72.44-409.22,83.64"></path>
        </svg>
      </div>
      
      <div class="order-number">
        <p>è®¢å•ç¼–å·ï¼š<span id="orderId"></span></p>
      </div>
      
      <div class="payment-network">
        <p>å½“å‰<span id="currency">USDT</span>æ”¯ä»˜åŒºå—ç½‘ç»œåè®®ä¸º<span id="network">TRC20</span></p>
      </div>
      
      <div class="warning-message">
        <p class="error">ï¼åˆ°è´¦é‡‘é¢å¿…é¡»ä¸ä¸‹æ–¹æ˜¾ç¤ºçš„é‡‘é¢ä¸€è‡´ï¼Œå¦åˆ™ç³»ç»Ÿæ— æ³•ç¡®è®¤ï¼ï¼</p>
        <p class="copy-tip">å°è¯•ç‚¹å‡»é’±åŒ…åœ°å€æˆ–é‡‘é¢å¯ç›´æ¥å¤åˆ¶å“¦ğŸ‘‡</p>
      </div>
      
      <div class="payment-amount" id="amountContainer">
        <span class="amount" id="amount">72.98</span>
        <span class="currency" id="currencyLabel">USDT</span>
      </div>
      
      <div class="wallet-address" id="walletAddress">
        <!-- é’±åŒ…åœ°å€å°†é€šè¿‡JavaScriptåŠ¨æ€è®¾ç½® -->
      </div>
      
      <div class="qr-code" id="qrCodeContainer">
        <div id="expiredOverlay" class="expired-overlay" style="display: none;">
          <div class="expired-message">
            <p>äºŒç»´ç å·²è¿‡æœŸ</p>
            <button class="refresh-btn" id="refreshBtn">åˆ·æ–°äºŒç»´ç </button>
          </div>
        </div>
        <canvas id="qrCode"></canvas>
        <div id="loadingQr" class="loading-qr">ç”ŸæˆäºŒç»´ç ä¸­...</div>
      </div>
      
      <div class="payment-memo">
        <div class="memo-title">ä»˜æ¬¾è¯´æ˜</div>
        <div class="memo-text">
          <p>1. ä½¿ç”¨<span class="important">ä»»æ„æ”¯æŒ${network}ç½‘ç»œçš„é’±åŒ…</span>æ‰«æä¸Šæ–¹äºŒç»´ç </p>
          <p>2. ä»˜æ¬¾é‡‘é¢è¯·å¡«å†™ï¼š<span class="important">${amount} ${currency}</span></p>
          <p>3. <span class="important">åŠ¡å¿…å¤‡æ³¨è®¢å•å·</span>è¿›è¡Œè½¬è´¦ï¼š</p>
          <p id="memoText">å¤‡æ³¨å†…å®¹ï¼šORDER_202504131</p>
          <button class="refresh-btn" id="copyMemo" style="margin-top: 5px;">å¤åˆ¶å¤‡æ³¨</button>
        </div>
      </div>
      
      <div class="countdown">
        <p class="validity-notice">äºŒç»´ç æœ‰æ•ˆæœŸï¼š2åˆ†é’Ÿ</p>
        <div class="timer">
          <span class="time" id="hours">00</span>
          <span class="label">æ—¶</span>
          <span class="time" id="minutes">02</span>
          <span class="label">åˆ†</span>
          <span class="time" id="seconds">00</span>
          <span class="label">ç§’</span>
        </div>
      </div>

      <!-- ç½‘ç»œé€‰æ‹©å™¨ -->
      <div class="network-selector" style="margin-top: 20px; padding-top: 15px; border-top: 1px dashed #ddd;">
        <p style="margin-bottom: 10px; font-size: 14px; color: #666;">é€‰æ‹©æ”¯ä»˜ç½‘ç»œï¼š</p>
        <div class="network-buttons" style="display: flex; justify-content: center; gap: 10px;">
          <button id="network-trc20" class="network-btn active-network" style="padding: 8px 15px; border-radius: 4px; border: 1px solid #e0e0e0; background: #f5f5f5; cursor: pointer;">TRC20</button>
          <button id="network-erc20" class="network-btn" style="padding: 8px 15px; border-radius: 4px; border: 1px solid #e0e0e0; background: #f5f5f5; cursor: pointer;">ERC20</button>
          <button id="network-bep20" class="network-btn" style="padding: 8px 15px; border-radius: 4px; border: 1px solid #e0e0e0; background: #f5f5f5; cursor: pointer;">BEP20</button>
        </div>
      </div>

      <div class="network-info">
        <p>æ³¨æ„ï¼šåœ¨<span id="networkInfo">TRC20</span>ç½‘ç»œä¸Šï¼Œä»˜æ¬¾æ—¶è¯·åœ¨å¤‡æ³¨/memoä¸­å¡«å†™è®¢å•å·ï¼Œä»¥ä¾¿ç³»ç»Ÿè‡ªåŠ¨å…³è”æ‚¨çš„è®¢å•ã€‚æ²¡æœ‰å¤‡æ³¨çš„ä»˜æ¬¾å¯èƒ½æ— æ³•è‡ªåŠ¨å¤„ç†ã€‚</p>
      </div>
    </div>
  </div>
  
  <div class="toast" id="toast"></div>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // è·å–URLå‚æ•°
      const urlParams = new URLSearchParams(window.location.search);
      
      // è®¾ç½®é»˜è®¤å€¼ - æ‰€æœ‰é’±åŒ…åœ°å€éƒ½ä»è¿™é‡Œç»Ÿä¸€è®¾ç½®
      const defaultWallet = 'TMKJoYUtd6f3XKEokSoUL5XrSgggT4T4uF';
      const defaultAmount = '72.98';
      const defaultCurrency = 'USDT';
      const defaultNetwork = 'TRC20';
      const defaultOrderId = generateOrderId();
      const expiryMinutes = 2;
      
      // ç½‘ç»œå¯¹åº”çš„é’±åŒ…åœ°å€ - å¦‚éœ€æ”¯æŒå¤šç½‘ç»œï¼Œå¯åœ¨æ­¤é…ç½®
      const networkWallets = {
        'TRC20': defaultWallet,
        'ERC20': defaultWallet, // åç»­å¯æ”¹ä¸ºERC20é’±åŒ…åœ°å€
        'BEP20': defaultWallet  // åç»­å¯æ”¹ä¸ºBEP20é’±åŒ…åœ°å€
      };
      
      // å¯åŠ¨å€’è®¡æ—¶
      let countdownInterval;
      let expiryTime;
      
      // è·å–æ”¯ä»˜ä¿¡æ¯
      const network = urlParams.get('network') || defaultNetwork;
      const amount = urlParams.get('amount') || defaultAmount;
      const currency = urlParams.get('currency') || defaultCurrency;
      const orderId = urlParams.get('orderId') || defaultOrderId;
      
      // æ ¹æ®ç½‘ç»œè·å–å¯¹åº”çš„é’±åŒ…åœ°å€
      const walletAddress = urlParams.get('address') || networkWallets[network] || defaultWallet;
      
      // å¡«å……é¡µé¢æ•°æ®
      document.getElementById('walletAddress').textContent = walletAddress;
      document.getElementById('amount').textContent = amount;
      document.getElementById('currency').textContent = currency;
      document.getElementById('currencyLabel').textContent = currency;
      document.getElementById('network').textContent = network;
      document.getElementById('networkInfo').textContent = network;
      document.getElementById('orderId').textContent = orderId;
      document.getElementById('memoText').textContent = `å¤‡æ³¨å†…å®¹ï¼š${orderId}`;
      
      // æ›´æ–°ä»˜æ¬¾è¯´æ˜
      document.querySelector('.payment-memo .memo-text p:nth-child(1)').innerHTML = 
        `1. ä½¿ç”¨<span class="important">ä»»æ„æ”¯æŒ${network}ç½‘ç»œçš„é’±åŒ…</span>æ‰«æä¸Šæ–¹äºŒç»´ç `;
      document.querySelector('.payment-memo .memo-text p:nth-child(2)').innerHTML = 
        `2. ä»˜æ¬¾é‡‘é¢è¯·å¡«å†™ï¼š<span class="important">${amount} ${currency}</span>`;
      
      // ç”ŸæˆäºŒç»´ç å’Œå¯åŠ¨å€’è®¡æ—¶
      generateQRCode();
      startCountdown();
      
      // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
      document.getElementById('amountContainer').addEventListener('click', function() {
        copyToClipboard(amount);
      });
      
      document.getElementById('walletAddress').addEventListener('click', function() {
        copyToClipboard(walletAddress);
      });
      
      document.getElementById('refreshBtn').addEventListener('click', function() {
        refreshQRCode();
      });

      document.getElementById('copyMemo').addEventListener('click', function() {
        copyToClipboard(orderId);
      });
      
      // ç”Ÿæˆè®¢å•ID
      function generateOrderId() {
        const timestamp = new Date().getTime().toString();
        const random = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
        return `ORDER_${timestamp.substr(-10)}${random}`;
      }
      
      // ç”ŸæˆäºŒç»´ç 
      function generateQRCode() {
        const qrContainer = document.getElementById('qrCode');
        const loadingElement = document.getElementById('loadingQr');
        
        // æ˜¾ç¤ºåŠ è½½ä¸­
        loadingElement.style.display = 'block';
        
        // äºŒç»´ç å†…å®¹ - ä»…åŒ…å«é’±åŒ…åœ°å€ï¼Œå¤§å¤šæ•°é’±åŒ…åªéœ€è¦åœ°å€å³å¯è¯†åˆ«
        const content = walletAddress;
        
        // ç”ŸæˆäºŒç»´ç 
        QRCode.toCanvas(qrContainer, content, {
          width: 200,
          margin: 1,
          color: {
            dark: '#000000',
            light: '#ffffff'
          }
        }, function(error) {
          if (error) {
            console.error('Error generating QR code:', error);
          }
          // éšè—åŠ è½½ä¸­
          loadingElement.style.display = 'none';
        });
      }
      
      // å¯åŠ¨å€’è®¡æ—¶
      function startCountdown() {
        // éšè—è¿‡æœŸé®ç½©
        document.getElementById('expiredOverlay').style.display = 'none';
        
        // è®¾ç½®è¿‡æœŸæ—¶é—´ - ä»ç°åœ¨å¼€å§‹2åˆ†é’Ÿ
        expiryTime = new Date();
        expiryTime.setMinutes(expiryTime.getMinutes() + expiryMinutes);
        
        // æ›´æ–°å€’è®¡æ—¶
        updateRemainingTime();
        
        // æ¸…é™¤ä»»ä½•ç°æœ‰çš„è®¡æ—¶å™¨
        if (countdownInterval) {
          clearInterval(countdownInterval);
        }
        
        // æ¯ç§’æ›´æ–°ä¸€æ¬¡å€’è®¡æ—¶
        countdownInterval = setInterval(updateRemainingTime, 1000);
      }
      
      function updateRemainingTime() {
        const now = new Date();
        const diff = Math.max(0, Math.floor((expiryTime - now) / 1000));
        
        if (diff <= 0) {
          clearInterval(countdownInterval);
          
          // æ˜¾ç¤ºè¿‡æœŸé®ç½©
          document.getElementById('expiredOverlay').style.display = 'flex';
          
          // é‡ç½®è®¡æ—¶å™¨æ˜¾ç¤ºä¸º00:00:00
          document.getElementById('hours').textContent = '00';
          document.getElementById('minutes').textContent = '00';
          document.getElementById('seconds').textContent = '00';
          
          return;
        }
        
        // æ›´æ–°æ—¶é—´
        const hours = Math.floor(diff / 3600);
        const minutes = Math.floor((diff % 3600) / 60);
        const seconds = diff % 60;
        
        document.getElementById('hours').textContent = formatTime(hours);
        document.getElementById('minutes').textContent = formatTime(minutes);
        document.getElementById('seconds').textContent = formatTime(seconds);
      }
      
      function formatTime(value) {
        return value.toString().padStart(2, '0');
      }
      
      // å¤åˆ¶åˆ°å‰ªè´´æ¿
      function copyToClipboard(text) {
        navigator.clipboard.writeText(text)
          .then(() => {
            showToast('å¤åˆ¶æˆåŠŸï¼');
          })
          .catch(err => {
            console.error('Failed to copy text: ', err);
            
            // å›é€€æ–¹æ¡ˆ - åˆ›å»ºä¸€ä¸ªä¸´æ—¶å…ƒç´ 
            const tempElement = document.createElement('textarea');
            tempElement.value = text;
            document.body.appendChild(tempElement);
            tempElement.select();
            
            try {
              document.execCommand('copy');
              showToast('å¤åˆ¶æˆåŠŸï¼');
            } catch (err) {
              console.error('å¤åˆ¶å¤±è´¥:', err);
              showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
            }
            
            document.body.removeChild(tempElement);
          });
      }
      
      // æ˜¾ç¤ºæç¤º
      function showToast(message) {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.classList.add('show');
        
        setTimeout(() => {
          toast.classList.remove('show');
        }, 2000);
      }
      
      // åˆ·æ–°äºŒç»´ç 
      function refreshQRCode() {
        generateQRCode();
        startCountdown();
      }

      // ç»‘å®šç½‘ç»œé€‰æ‹©å™¨äº‹ä»¶
      document.getElementById('network-trc20').addEventListener('click', function() {
        switchNetwork('TRC20');
      });
      
      document.getElementById('network-erc20').addEventListener('click', function() {
        switchNetwork('ERC20');
      });
      
      document.getElementById('network-bep20').addEventListener('click', function() {
        switchNetwork('BEP20');
      });
      
      // åˆ‡æ¢ç½‘ç»œå‡½æ•°
      function switchNetwork(newNetwork) {
        // æ›´æ–°å½“å‰é€‰æ‹©çš„ç½‘ç»œ
        network = newNetwork;
        
        // æ›´æ–°UIæ˜¾ç¤º
        document.getElementById('network').textContent = network;
        document.getElementById('networkInfo').textContent = network;
        
        // æ›´æ–°é’±åŒ…åœ°å€
        const newWalletAddress = networkWallets[network] || defaultWallet;
        document.getElementById('walletAddress').textContent = newWalletAddress;
        
        // æ›´æ–°ä»˜æ¬¾è¯´æ˜
        document.querySelector('.payment-memo .memo-text p:nth-child(1)').innerHTML = 
          `1. ä½¿ç”¨<span class="important">ä»»æ„æ”¯æŒ${network}ç½‘ç»œçš„é’±åŒ…</span>æ‰«æä¸Šæ–¹äºŒç»´ç `;
        
        // æ›´æ–°ç½‘ç»œæŒ‰é’®çŠ¶æ€
        document.querySelectorAll('.network-btn').forEach(btn => {
          btn.classList.remove('active-network');
        });
        document.getElementById(`network-${network.toLowerCase()}`).classList.add('active-network');
        
        // é‡æ–°ç”ŸæˆäºŒç»´ç 
        generateQRCode();
        
        // é‡æ–°å¯åŠ¨å€’è®¡æ—¶
        startCountdown();
      }
    });
  </script>
</body>
</html> 